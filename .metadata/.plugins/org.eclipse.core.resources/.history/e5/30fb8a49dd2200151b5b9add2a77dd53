/**
 * 项目  dzah-hibernate 
 * 创建时间  2015-7-5 下午2:09:59 
 * Copyright (c) 2015, wchhuangya All rights reserved.
 * wchhuangya 专有/保密源代码,未经许可禁止任何人通过任何* 渠道使用、修改源代码.
 */

package com.ch.wchhuangya.dzah.hibernate.web;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.ch.wchhuangya.dzah.hibernate.util.HibernateUtil;


/**
 * 类名: EventManagerServlet <br/> 
 * 功能: 事件处理的servlet。本例使用的模式为：session-per-request，即，当servlet接收到请求时，
 * 通过在SessionFactory上对getCurrentSession()方法的第一次调用 ，新的Hibernate Session就被打开了。 <br/> 
 * 创建日期: 2015-7-5 下午2:09:59 <br/> 
 *
 * @author wchya
 * @since Jdk 1.6
 * @see       
 *
 */
public class EventManagerServlet extends HttpServlet {

	private static final long serialVersionUID = 7187091300011868759L;

	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp)
			throws ServletException, IOException {
		//SimpleDateFormat dateFormatter = new SimpleDateFormat( "dd.MM.yyyy" );

        try {
            // 工作单元开始
            HibernateUtil.getSessionFactory().getCurrentSession().beginTransaction();

            // 处理请求和渲染页面

            // 工作单元结束
            HibernateUtil.getSessionFactory().getCurrentSession().getTransaction().commit();
        }
        catch (Exception ex) {
            HibernateUtil.getSessionFactory().getCurrentSession().getTransaction().rollback();
            if ( ServletException.class.isInstance( ex ) ) {
                throw ( ServletException ) ex;
            }
            else {
                throw new ServletException( ex );
            }
        }
	}
}
